<div class="flex flex-col lg:flex-row gap-10">

  <!-- Poster -->
  <div class="flex justify-center items-start w-full lg:w-1/3">
    <% if @movie.poster.attached? %>
      <%= image_tag @movie.poster, class: "w-full max-w-xs rounded-lg shadow-lg object-cover" %>
    <% else %>
      <div class="w-full max-w-xs h-64 bg-gray-700 rounded-lg flex items-center justify-center text-gray-400">
        Sem imagem
      </div>
    <% end %>
  </div>

  <!-- Informa√ß√µes -->
  <div class="w-full lg:w-2/3">
    <h1 class="text-4xl font-bold text-yellow-400 mb-4"><%= @movie.title %></h1>

    <p class="text-gray-300 mb-3"><strong>Sinopse:</strong> <%= @movie.synopsis %></p>
    <p class="text-gray-300 mb-1"><strong>Ano:</strong> <%= @movie.year %></p>
    <p class="text-gray-300 mb-1"><strong>Dura√ß√£o:</strong> <%= @movie.duration %> min</p>
    <p class="text-gray-300 mb-3"><strong>Diretor:</strong> <%= @movie.director %></p>

    <p class="text-gray-300 mb-4">
      <strong>Categorias:</strong>
      <% if @movie.categories.any? %>
        <% @movie.categories.each do |c| %>
          <span class="bg-indigo-600 text-white text-xs px-2 py-1 rounded-md mr-1"><%= c.name %></span>
        <% end %>
      <% else %>
        Nenhuma categoria definida
      <% end %>
    </p>

    <% if user_signed_in? && current_user == @movie.user %>
      <div class="flex gap-3 mt-6">
        <%= link_to "‚úèÔ∏è Editar", edit_movie_path(@movie),
            class: "bg-yellow-500 hover:bg-yellow-600 text-black px-4 py-2 rounded-md font-bold transition" %>

        <%= button_to "üóëÔ∏è Excluir", @movie, method: :delete,
            data: { confirm: "Tem certeza que deseja excluir este filme?" },
            class: "bg-red-600 hover:bg-red-700 px-4 py-2 rounded-md font-bold text-white transition" %>
      </div>
    <% end %>
  </div>
</div>

<!-- Coment√°rios -->
<div class="mt-10 border-t border-gray-800 pt-6">
  <h2 class="text-xl font-semibold text-gray-200 mb-4">üí¨ Coment√°rios</h2>

  <% if user_signed_in? %>
    <%= form_with(model: [@movie, Comment.new], local: true, class: "mb-6") do |form| %>
      <div class="flex flex-col gap-2">
        <%= form.text_area :content, rows: 3,
              placeholder: "Escreva um coment√°rio...",
              class: "w-full px-4 py-2 rounded bg-gray-800 border border-gray-700 text-white" %>

        <%= form.submit "Comentar",
              class: "bg-yellow-500 hover:bg-yellow-600 text-black font-bold px-4 py-2 rounded-md transition self-start" %>
      </div>
    <% end %>
  <% else %>
    <p class="text-gray-400 mb-4">Fa√ßa login para comentar.</p>
  <% end %>

  <% if @movie.comments.any? %>
    <% @movie.comments.each do |comment| %>
      <% author =
           comment.user&.name.presence ||
           (comment.user&.email&.split("@")&.first) ||
           comment.name.presence ||
           "An√¥nimo" %>

      <div class="bg-gray-800 text-gray-200 p-3 rounded-md mb-3 border border-gray-700">
        <p><%= comment.content %></p>
        <span class="text-xs text-gray-500">por <%= author %></span>
      </div>
    <% end %>
  <% else %>
    <p class="text-gray-400 text-sm">Nenhum coment√°rio ainda... Seja o primeiro! ‚ú®</p>
  <% end %>
</div>
